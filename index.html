<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>WEB VISION - シンプル表示</title>
  <style>
    body { 
      font-family: sans-serif; 
      margin: 20px; 
    }
    input[type="text"] { 
      width: 300px; 
      padding: 6px; 
      font-size: 14px;
    }
    button { 
      padding: 6px 12px; 
      font-size: 14px; 
    }
  </style>
</head>
<body>
  <div id="interface">
    <h1>WEB VISION</h1>
    <p>表示したい URL を入力してください：</p>
    <form id="urlForm">
      <input type="text" id="urlInput" placeholder="https://example.com" required>
      <button type="submit">表示</button>
    </form>
    <p>
      ※ この方法は、対象サイトが CORS などの制約を設けていない場合にのみ動作します。
    </p>
  </div>

  <script>
    // URL パラメータ "url" があるかチェック
    const params = new URLSearchParams(window.location.search);
    const targetUrl = params.get("url");

    if (targetUrl) {
      // URL 指定がある場合、取得中のメッセージを表示
      document.body.innerHTML = "<p>取得中...</p>";

      // 指定 URL のコンテンツを fetch() で取得して、document.write() で置き換え
      fetch(targetUrl)
        .then(response => {
          if (!response.ok) {
            throw new Error("ネットワークエラー: " + response.status);
          }
          return response.text();
        })
        .then(htmlText => {
          // 取得したコンテンツで現在のドキュメントを置き換え
          document.open();
          document.write(htmlText);
          document.close();
        })
        .catch(err => {
          document.body.innerHTML = "<p>エラー: " + err.message + "</p>";
        });
    } else {
      // 初期画面：URL入力フォームの処理
      document.getElementById("urlForm").addEventListener("submit", function(e) {
        e.preventDefault();
        const url = document.getElementById("urlInput").value;
        // 同一ページに URL パラメータを付与してリダイレクト
        window.location.href = window.location.pathname + "?url=" + encodeURIComponent(url);
      });
    }
  </script>
</body>
</html>
